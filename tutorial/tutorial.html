---
layout: default
slug:   tutorial
category: tutorial
title:  An End-to-End-Tutorial - INSPIRE data specification extensions

---

<section>
  <h1>The End-To-End Tutorial</h1>

  <p>After all the background and methodology, it's time to get our hands dirty. For this tutorial, we will use as many freely accessible tools (such as Open Source) as possible to make the material more accessible. You will need the following software installed on your Linux/Windows/Mac environment:</p>

  <ol>
    <li>Data Modelling: <a href="http://www.sparxsystems.com.au/" target="_blank">Enterprise Architect 12.0</a></li>
    <li>Schema Transformation: <a href="http://shapechange.net/" target="_blank">ShapeChange 2.1.0 (Open Source)</a></li>
    <li>Data Transformation: <a href="https://www.wetransform.to/products/halestudio/" target="_blank">hale studio 2.9.4 (Open Source)</a></li>
    <li>Service Publishing: <a href="http://www.deegree.org/" target="_blank">deegree 3.3.18 (Open Source)</a></li>
  </ol>

  <p>You also need a test data set to play around with in later stages of the project. We're going to use an SQLite CDDA data set that we can <a href="http://www.eea.europa.eu/data-and-maps/data/nationally-designated-areas-national-cdda-10#tab-gis-data" target="_blank">download from the European Environmental Agency</a> .</p>

  <table class="alert-warning important-info">
    <tr>
      <td style="width:3em"><div class="important-info-icon"><span class="glyphicon glyphicon-exclamation-sign" style="font-size:2em"></span></div></td>
      <td>We use an existing INSPIRE extension for CDDA for the purpose of this example. If you need to deliver CDDA data, please use the official extension, and not a custom variant you might build using this tutorial.</td>
    </tr>
  </table>

  <h2><a href="#analysis" id="analysis" name="analysis"></a>Analysis</h2>

  <blockquote>
    <p>It's late on a rainy Friday afternoon. I am in the middle of reviewing an article when my boss Alex calls. He sounds agitated and tells me that there is a problem, so he needs me to help him. Ten minutes later, we sit together at the bar of the pub across the road. Alex tells me about the meeting he has had in the last two days in the capitol city, with many other directors of public authorities.
    </p>
    <p>
      After ordering our drinks, Alex starts to tell me what bothers him: &laquo;<em>We're being blamed for lack of progress on two projects. The ministry is under pressure from the EU, because of our lack of progress in INSPIRE implementation. In addition, after last year's new legal act, we're supposed to implement a new protected sites reporting system using the Common Database on Designated Areas (CDDA) standard, but we haven't made any headway on this one either. After the meeting yesterday, we at least have some funding for the CDDA project, though there is almost no budget for INSPIRE. I need you to take over the protected sites implementation project, while I will figure out how to fund the INSPIRE project.&raquo;</em> I listen to his explanations for a few more moments, then I interrupt him: &laquo;<em>You know what? Give me both your problem projects. I have an idea how we can make both work at the same time, with one budget! Do I have your support?&raquo;</em>
    </p>
    <p>Two weeks later, I've assembled my team. I've got three domain experts from nature conservation, Chris, who is an integration expert and Thorbjörn, who is an ETL expert. It was really hard to get some of them on board - everybody is tied up in their daily projects, and some were not exactly keen on INSPIRE. In our first meeting, we analyse relevant documents and take a look at the <a href="/patterns/index.html#modelPatterns">model patterns</a>. We quickly decide that we will use the <a href="/patterns/inspire.html"> INSPIRE extension pattern</a>, which means that whatever model we design, our model is not allowed to make compatibility-breaking changes.</p>
  </blockquote>

  <p>After you've <a href="/extension-methodology.html#organisation">set up your team and got organised</a>, your team's first step is to perform an analysis on the requirements for the extended data model. These requirements come from various sources, such as legal texts or implementation rules. The following text example describes CDDA:</p>

  <blockquote>
    <p>The Common Database on Designated Areas (CDDA) is more commonly known as Nationally designated areas. The inventory began in 1995 under the CORINE programme of the European Commission. It is now one of the agreed Eionet priority data flows maintained by EEA with support from the European Topic Centre on Biological Diversity. It is a result of an annual data flow through Eionet countries. The EEA publishes the data set and makes it available to the World Database of Protected Areas (WDPA). The CDDA data can also be queried online in the European Nature Information System (EUNIS).</p>
    <p>The database is divided into a national area and an international area. The national area is for member states of the EU or EEA about the European Environment Information and Observation Network or EIONET. Data cleansing for the national area of non-EEA members and the international area is carried out by UNEP-WCMC systems. The database follows the system of the International Union for Conservation of Nature and Natural Resources (IUCN) and the standards of the United Nations in order to ensure compatibility with similar data banks worldwide, especially the World Database on Protected Areas (WDPA).</p>
  </blockquote>

  <p>The EEA also provides an <a href="http://www.eea.europa.eu/data-and-maps/data/nationally-designated-areas-national-cdda-8/" target="_blank">Excel tables</a>  that describes the data model in detail. From these tables, we learn that the final data model will need to contain information on the following properties of designated areas:</p>

  <ul>
    <li><strong>Designations</strong> need to be described by providing an <a href="http://unstats.un.org/unsd/methods/m49/m49alpha.htm" target="_blank">ISO ALPHA-3</a> code of the reporting country, the ISO ALPHA-3 code of the country where the data originate from, a national designation type code, the title of the designation in the original language and in English, a reference to the legal text covering the designation as well as a Reference to the Official Journal where the law was published. Furthermore, the Designation need to have the address of the administrative authority responsible for the designation, the total number of sites and the total area in hectares covered for this designation. Finally, there should be space for remarks concerning the designation.</li>
    <li><strong>Designated Sites</strong> have a Unique record identifier for nationally designated areas, a national site code, an <a href="http://unstats.un.org/unsd/methods/m49/m49alpha.htm" target="_blank">ISO ALPHA-3</a> code of the reporting country, the ISO ALPHA-3 code of the country where the data originate from, a National designation type code, a name of the site in local language and the surface area of site in hectares. They are also described through a IUCN management category, the year of establishment (when the site was first time designated), and the year and code of the last legal change. The location is indicated by geographical latitude (x, y) in decimal degrees format. Finally, each record also contains information on licensing and remarks on the site record.</li>
  </ul>

  <p>The table describes additional potential classes for our model, such as Designation Boundaries, Site Boundaries and a National Overview.</p>

  <h2><a href="#comparison" id="comparison" name="comparison"></a>Finding your scope and comparing to existing specifications</h2>

  <p>In a first step, we need to identify which INSPIRE data specifications are a good match for our extension project. We use the <a href="http://inspire-regadmin.jrc.ec.europa.eu/dataspecification/" target="_blank">Interactive Data Specifications Find your Scope tool</a> for this purpose. We start with a <em>Direct search</em>, where we enter &laquo;Designation&raquo;:</p>

  <div style="margin: 20px">
    <img src="/images/tutorial-find-your-scope.png" title="Find your scope - Designation" style="width: 100%; min-width: 400px;">
  </div>

  <p>We get a couple of direct hits, among them the theme &laquo;Protected Sites&raquo; and the spatial object type <code>Protected Site</code>. Since we're going to deal with protected sites, let's look at that in detail. We click on the name, and learn that this type has several relevant properties such as <code>legalFoundationDate</code> and <code>legalFoundationDocument</code>, both of which are required in the CDDA definition:</p>

  <div style="margin: 20px">
    <img src="/images/tutorial-find-your-scope-protected-site.png" title="Find your scope - Protected Site properties" style="width: 100%; min-width: 400px;">
  </div>

  <p>Next, we do a complete comparison of the requirements of our CDDA model extension with the INSPIRE Protected Sites model. This comparison results in the following coverage table:</p>

  <table class="table table-responsive table-striped">
    <tr>
      <th>Requirement</th>
      <th>Covered</th>
      <th>Not covered</th>
    </tr>
    <tr>
      <td>IE-01 Designation Type</td>
      <td>The required Type Designation Type can be matched to the to the INSPIRE data type <code>DesignationType</code>. We can use <code>designationScheme</code> to indicate the CDDA/IUCN designation, and use <code>designation</code> for the name of the designation.</td>
      <td>All other properties - such as country codes, a citation for the responsible authority and statistical summaries - need to be added.</td>
    </tr>
    <tr>
      <td>IE-02 Designated Areas Type</td>
      <td>The required type <code>Designated Area</code> can be matched to the INSPIRE spatial object type <code>Protected Site</code>. We can use the <code>legalFoundationDate</code> and <code>legalFoundationDocument</code> properties to indicate when a new site was formed, and what the legal foundation was for its formation. We use <code>siteName</code> to cover the naming requirements in multiple languages.</td>
      <td>There are several properties that CDDA requires which the <code>ProtectedSites</code> object type does not cover. These include remarks and data dissemination rules, the ISO country codes, the IUCN category, the major ecosystem type, an indication of the marine area, the national ID, the type of protected area, a representative point geometry, a resolution code and information on availability of additional spatial data.</td>
    </tr>
  </table>

  <h2><a href="#extension" id="extension" name="extension"></a>Extension Design (Modelling)</h2>

  <blockquote>
    <p>We now know exactly what we need to add to the INSPIRE data specification, but we don't yet know how we should do it. I organise a two-day meeting with the others of my working group in a somewhat remote location, in the hopes of getting everyone's full attention. After the usual agenda setting and introductions, we directly start working. First of all, we prioritize requirements and then start with the most important requirement. For each requirement, everybody on the team gets three minutes to decide how he or she would design a model for that requirement, using any tools they prefer. Most of us simply draw on the ample whiteboards we have in the room. Everybody then presents their design, and the others give feedback about aspects they like or dislike. During all the time, I note down the likes and dislikes, and consolidate them into a single conceptual model using a UML modelling software. After an intense day, we've gone through all requirements. While the others are off to enjoy a well-deserved beer on the patio, I finalize the integrated draft model.</p>
  </blockquote>

  <p>One of the key challenges we have to resolve is to pick the right extension pattern. We discuss two main extension patterns - <a href="/patterns/inheritance.html">Inheritance</a> and <a href="/patterns/association.html">Association</a>. The main difference is that when we use <code>inheritance</code>, we will have a single object that complies to the requirements of the INSPIRE, while when we use <code>Association</code>, we will have two objects, where the <code>DesignatedArea</code> object will reference the ProtectedSite object. This is what the UML model for the Inheritance approach looks like:</p>

  <div style="margin: 20px">
    <img src="/images/tutorial-uml-inheritance.png" title="UML Diagram for Inheritance-based Extension" style="width: 100%; min-width: 400px;">
  </div>

  <p>This is what the comparable UML model for the Association approach looks like:</p>

  <div style="margin: 20px">
    <img src="/images/tutorial-uml-association.png" title="UML Diagram for Association-based Extension" style="width: 100%; min-width: 400px;">
  </div>

  <p>In the end, we decide to use the association approach, so that the core INSPIRE <code>ProtectedSite</code> object can also be used independent of all the CDDA-related properties.</p>

  <h3>Set up the Extension Model</h3>

  <p>To create the association-based UML model in Enterprise Architect, proceed as follows:</p>

  <ol class="workflow">
    <li>Download the INSPIRE UML model as a EA file from the <a href="http://inspire.ec.europa.eu/index.cfm/pageid/2/list/datamodels" target="_blank">INSPIRE site</a>.</li>
    <li>Start Enterprise Architect and open the INSPIRE UML model. Since you loaded the existing INSPIRE model, you will also automatically use the &laquo;UML Profile for INSPIRE&raquo;.</li>
    <li>Save the model to a new name to represent your extension. In this example, use <code>CDDA</code>.</li>
    <li>In the Project Browser, click on &laquo;Add Model&raquo; to create a new Model. In the Model Wizard, click on &laquo;Geospatial&raquo; and then select &laquo;GML Application Schema&raquo;. Call the new model <code>CDDA Designated Area</code>.
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-model-creation.png" title="UML Model creation for a GML Application Schema" style="width: 50%; min-width: 400px; margin-left: 25%; margin-right: 25%">
      </div>
    </li>
    <li>In the Project Browser, click on &laquo;Add Package&raquo; to create a new Package in the Model you just created. Call the package <code>CDDA Designated Area</code>.</li>
    <li>In the Project Browser, right-click on the new package and click on &laquo;Properties&raquo;. In this window, set the stereotype property to <code>applicationSchema</code>. This helps Shapechange later on to identify for which packages it needs to generate GML application schemas for.
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-package-stereotype.png" title="UML Package Stereotype for a GML Application Schema" style="width: 90%; min-width: 400px; margin-left: 5%; margin-right: 5%">
      </div>
      Furthermore, go to the &laquo;UML Profile for INSPIRE&raquo; tab and set the values of the properties <code>targetNamespace</code>, <code>version</code>, <code>xmlns</code> and <code>xsdDocument</code>.
    </li>
    <li>In the Project Browser, right-click on the new package and click on &laquo;Add Diagram...&raquo;. Select &laquo;UML Structural&raquo; and then select &laquo;Class Diagram&raquo;. Give the diagram a name, such as <code>CDDA Designated Area</code>, and then open the diagram.</li>
  </ol>

  <p>Now, you have a canvas on which to model your extension. First, let's pull in the types from the INSPIRE model that we want to use in our extension:</p>

  <ol class="workflow">
    <li>In the Project Browser, expand the &laquo;INSPIRE Consolidated UML Model&raquo;</li>
    <li>Then, go to &laquo;Themes&raquo;, &laquo;Annex I&raquo;, &laquo;Protected Sites&raquo;, &laquo;Protected Sites Simple&raquo;.</li>
    <li>Select the feature type <code>ProtectedSite</code>, and drag and drop it into your new diagram.</li>
    <li>Select the data type <code>DesignationType</code>, and drag and drop it into your new diagram.</li>
  </ol>

  <h3>Add a new Type and new properties</h3>

  <p>The next step is to add your own extension by creating a new type. Proceed as follows:</p>

  <ol class="workflow">
    <li>From the Toolbox, drag a Class into your drawing. Call it <code>DesignatedArea</code>.</li>
    <li>Set the stereotype of the new class to <code>featureType</code>.</li>
    <li>Make sure the values for the &laquo;UML profile for INSPIRE&raquo; are set as follows:
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-class-profiletags.png" title="UML Class INSPIRE profile tags settings" style="width: 90%; min-width: 400px; margin-left: 5%; margin-right: 5%">
      </div>
    </li>
    <li>Confirm with &laquo;OK&raquo;.</li>
  </ol>

  <p>Your new <code>DesignatedArea</code> now needs to be associated with the <code>ProtectedSite</code> class:</p>

  <ol class="workflow">
    <li>In the diagram, select the new <code>DesignatedArea</code> class. On the top right hand side of the class, an arrow appear. Click and press on that arrow and drag its tip over to the <code>ProtectedSite</code> class.</li>
    <li>A popup appears. Pick &laquo;Association&raquo;.</li>
    <li>Double-click on the newly created association to edit its properties. Go to the Role(s) category and configure the target role as follows:
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-association-properties.png" title="UML association properties" style="width: 90%; min-width: 400px; margin-left: 5%; margin-right: 5%">
      </div>
    </li>
    <li>Confirm with &laquo;OK&raquo;.</li>
  </ol>

  <p>Now, we can add all the missing properties, one by one. Repeat the following process for all missing properties:</p>

  <ol class="workflow">
    <li>Right-click on the <code>DesignatedArea</code> class. Go to &laquo;Features &amp; Properties&raquo; and click on &laquo;Attributes...&raquo;.</li>
    <li>Click on &laquo;New Attribute&raquo; and enter the name of the Attribute, such as <code>remark</code>.</li>
    <li>Click on the &laquo;Type&raquo; column, and pick &laquo;Select Type...&raquo;.</li>
    <li>Go to the Search category, and type in <code>CharacterString</code>. You will see several results:
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-select-type.png" title="Select an attribute type" style="width: 70%; min-width: 400px; margin-left: 15%; margin-right: 15%">
      </div>
      Pick <code>CharacterString</code>. Instead of just typing something or picking one of the inbuilt primitive types, you should always first search whether a possible type you can use exists already in the INSPIRE and ISO models, like in this case. Re-using these types for properties helps tremendously with ensuring a compatible encoding.
    </li>
    <li>Change the value in the &laquo;Scope&raquo; column to <code>Public</code>.</li>
    <li>Make sure that you set the Multiplicity to the required value, e.g. <code>[1..*]</code>.
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-attribute-cardinality.png" title="Define the cardinality of an attribute" style="width: 90%; min-width: 400px; margin-left: 5%; margin-right: 5%">
      </div>
    </li>
    <li>Confirm with &laquo;Close&raquo;.</li>
  </ol>

  <h3>Add a new codelist</h3>

  <p>In some cases, there won't be an appropriate type to use for a property. You will have to create it yourself. In the CDDA model, it is particularity common that we need to add or <a href="/patterns/codelist-extension.html">extend codelists</a>. The following process describes how to add a new code list and needs to be repeated for each such code list type:</p>

  <ol class="workflow">
    <li>From the Toolbox, drag a Class into your drawing. Call it <code>CddaResolutionCodeValue</code>.</li>
    <li>Set the stereotype of the new class to <code>codeList</code>.</li>
    <li>Make sure the values for the &laquo;UML profile for INSPIRE&raquo; are set as follows:
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-codelist-new.png" title="New Codelist in UML" style="width: 90%; min-width: 400px; margin-left: 5%; margin-right: 5%">
      </div>
    </li>
    <li>Confirm with &laquo;OK&raquo;.</li>
    <li>To add individual coded values to the codelist, go to &laquo;Features &amp; Properties&raquo; and click on &laquo;Attributes...&raquo;. Create coded values in the same way you created attributes:
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-codelist-values.png" title="New Codelist values in UML" style="width: 90%; min-width: 400px; margin-left: 5%; margin-right: 5%">
      </div>
    </li>
    <li>Confirm creation of coded values with &laquo;Close&raquo;.</li>
    <li>Now that you have created the new codelist type, you can use it as an attribute type in the <code>DesignatedArea</code> class.</li>
  </ol>

  <h3>Extend an existing codelist</h3>

  <p>To extend a code list in UML, go through these steps:</p>

  <ol class="workflow">
    <li>In the Project Browser, navigate to the &laquo;Protected Sites Simple&raquo; schema, select <code>DesignationSchemeValue</code> and drag it into the diagram.</li>
    <li>From the Toolbox, drag a Class into your drawing. Call it <code>DesignationSchemeValue</code> as well, so that is can substitute the original code list later on.</li>
    <li>Set the stereotype of the new class <code>DesignationSchemeValue</code> to <code>codeList</code>. Also, make sure that the required values for the &laquo;UML profile for INSPIRE&raquo; are set:
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-codelist-extension.png" title="New Codelist extension in UML" style="width: 90%; min-width: 400px; margin-left: 5%; margin-right: 5%">
      </div>
    </li>
    <li>Click on the new class <code>DesignationSchemeValue</code>, then click and drag the arrow that appears on the top right of the class. Drop it on the original INSPIRE  <code>DesignationSchemeValue</code> codelist, and pick <code>Generalization</code> from the pop-up menu.</li>
    <li>Confirm with &laquo;OK&raquo;.</li>
    <li>Add additional coded values to the codelist. Go to &laquo;Features &amp; Properties&raquo; and click on &laquo;Attributes...&raquo;. Create coded values in the same way you created attributes.</li>
    <li>Confirm creation of coded values with &laquo;Close&raquo;. Your new codelist should now look like this in the UML diagram:
      <div style="margin: 20px">
        <img src="/images/tutorial-uml-codelist-extension-diagram.png" title="New Codelist extension in UML diagram" style="width: 50%; min-width: 400px; margin-left: 25%; margin-right: 25%">
      </div>
    </li>
    <li>Now that you have created the new Codelist type, you can use it as an attribute type in the <code>DesignatedArea</code> class.</li>
  </ol>

  <p>When you have repeated these steps for all required properties, we get the following model:</p>

  <div style="margin: 20px">
    <img src="/images/tutorial-uml-final-diagram.png" title="UML Diagram for Association-based Extension with Codelists" style="width: 100%; min-width: 400px;">
  </div>

  <h2><a href="#validation" id="validation" name="validation"></a>Validation</h2>

  <blockquote>
    <p>After the first day of the workshop, we've already drafted a first, rough model that covers most requirements. Before we hammer out all the details, I ask Chris, our integration expert, and Thorbjörn, the ETL expert, to quickly create a first prototype, so that we can learn what our data will look like. This is what they did:</p>
  </blockquote>

  <h3>Vertical Mapping</h3>

  <p>Our goal is now to see whether we can use the conceptual model we've designed to store and serve Designated Areas effectively. We thus create two logical models based on the conceptual model:</p>

  <ol>
    <li>The GML Application Schema, which we need to provide Download Services</li>
    <li>A PostgreSQL Database Schema, which we need to provide persistent storage for the Designated Areas</li>
  </ol>

  <p>We will use <a href="http://shapechange.net/get-started/" target="_blank">Shapechange</a> to create these two logical schemas. Make sure that Shapechange works correctly as per the instructions, and that the Enterprise Architect integration also works by following the steps in the Shapechange manual. We first generate the GML Application Schema. To do so, we need to create a configuration file for Shapechange first. Proceed as follows:</p>

  <ol class="workflow">
    <li>Open a programmer's text editor, such as <a href="https://notepad-plus-plus.org/" target="_blank">Notepad++</a>.</li>
    <li>In the editor, open the <a href="http://shapechange.net/resources/example/inspire_annex_ii_iii_ir.xml" target="_blank">example INSPIRE GML configuration</a>  provided with Shapechange. The first lines of that configuration files look like this:
      <pre data-line="4,5,6" class="line-numbers" data-src="/tutorial/examples/shapechange-config-fragment.xml"><code></code></pre>
    </li>
    <li>In line 4, set the value of the parameter <code>inputFile</code> to the path where your EAP model file resides. Make sure to use a Unix path (e.g. using single forward slashes).</li>
    <li>In line 5, set the name of your model as you would like to call it.</li>
    <li>The parameter <code>appSchemaNamespaceRegex</code> in line 6 allows you to limit for which namespaces Shapechange will generate XSDs. Set this to the namespace you used when creating the model, e.g. <code>^http://dd.eionet.europa.eu/.*</code></li>
    <li>You should also review the rest of the configuration. You might want to adjust the output path (<code>outputDirectory</code>), and you might need additional <code>xsdMapEntries</code>. These entries allow you to tell Shapechange which UML types (classes) map to which GML elements.</li>
  </ol>

  <p>To execute Shapechange and generate the GML schema, we will create a little shell script so that we will not wonder the next time we need to generate a schema how we did it. Complete these steps:</p>

  <ol class="workflow">
    <li>Open a programmer's text editor, such as Notepad++.</li>
    <li>If you're on Windows, open the <code>test.bat</code> script that came with Shapechange, otherwise open the <code>test.sh</code> file. In that file, you can see a call to execute Shapechange using Java:
      <pre class="line-numbers"><code class="language-bash">#!/bin/sh
java -jar ShapeChange-2.1.0.jar -Dfile.encoding=UTF-8 -c http://shapechange.net/resources/test/testXMI.xml</code></pre>
    </li>
    <li>Change that file so that the path points to the configuration file we've created previously.</li>
    <li>Save the modified file under a new name in the same folder, e.g. <code>inspire-extension-cdda.sh</code></li>
    <li>Open up a console window and navigate to your installation directory of Shapechange.</li>
    <li>Run the script you've created previously: <code>./inspire-extension-cdda.sh</code></li>
    <li>Assuming there were no errors in the configuration file, you now have an output folder with a log file and with the resulting GML Application Schema!</li>
  </ol>

  <p>Second, we generate a database schema for PostgreSQL. We do so by adding an additional transformation target to the existing Shapechange configuration:</p>

  <ol class="workflow">
    <li>In the programmer's text editor, open the configuration file we've created earlier. The later lines of that configuration file contain the definition of multiple output targets. We're going to add one for the generation of SQL, so that the file looks like this:
      <pre data-line="15,17" class="line-numbers" data-src="/tutorial/examples/shapechange-config-fragment-sql.xml"><code></code></pre>
    </li>
    <li>Make sure you adjust the output directory (Line 15). Also, set the Identifier of the spatial reference system you'd like to use to the correct value (Line 17).</li>
    <li>Save the file and re-run Shapechange as per the instructions above.</li>
  </ol>

  <h3>Data Integration</h3>

  <p>After creating the target schemas, it's now time for us to see what real data using these schemas looks like. Since the end product we need to create is INSPIRE GML, we will start with data integration into the GML Application Schema. We will use <a href="https://www.wetransform.to/products/halestudio/" target="_blank">hale studio 2.9.4+</a>  for that purpose.</p>

  <p>In hale studio, we define a transformation by mapping elements of a source schema to elements of the target schema. The sum of these mappings is called an <strong>Alignment</strong>. The source schema is the logical model of our existing data. In this case, we use a <a href="http://www.eea.europa.eu/data-and-maps/data/nationally-designated-areas-national-cdda-10#tab-gis-data" target="_blank">SQlite CDDA database (450MB)</a> as source data. The target schema is the GML Application Schema we've just generated.  Let's start hale studio and set up the transformation project first:</p>

  <ol class="workflow">
    <li>In hale, click on File &rarr; Import &rarr; Source Schema, and click &laquo;Browse&raquo; to pick the SQLite file you've downloaded.</li>
    <li>Next, click on File &rarr; Import &rarr; Target Schema, and click &laquo;Browse&raquo; to pick the GML Application Schema file you've generated before. Click &laquo;Finish&raquo;.</li>
    <li>Now, add the imported type <code>ProtectedSite</code> to the mappable types, so that it is visible as part of the target schema. In the main tool bar, go to the icon <img src="/images/tutorial-integration-02b-icon-mappable-types.png" class="img-rounded" /> (title: Edit mapping relevant target types). IN the dialog that appears, enter <code>ProtectedSite</code> in the search bar and pick the type from the field below. After you've added <code>ProtectedSite</code>, your project should look like this:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-01-schemas.png" title="hale studio with loaded schemas" style="width: 100%; min-width: 400px;">
      </div>
    </li>
    <li>In hale, you can use a data set to do live transformation and validation while you author the alignment. To enable this feature, activate &laquo;instance sampling&raquo; by clicking the left of the two icons in the red box:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-02-sampling.png" title="Enable instance sampling" style="width: 333px; margin-left: auto; margin-right: auto">
      </div>
      You can click on the right icon to configure the sampling, e.g. to indicate with how many feature you'd like to work.
    </li>
    <li>Next, we need to load the actual source data to work with. Go to File &rarr; Import &rarr; Source Data, and click &laquo;Browse&raquo; to pick the SQLite file you've downloaded. <em>Note that if you click the List icon left of the file input field, you can chose from the most recent files you've worked with - your SQLite DB will also be among them.</em></li>
  </ol>

  <p>Now, it is time to set up the alignment itself. In hale, we have two different levels of transformation functions:</p>

  <ol>
    <li>Type-level functions: These are used on entire objects, e.g. a <code>CadastralParcel</code>.</li>
    <li>Property-level functions: These are used on individual properties of objects, e.g. an <code>id</code> of a <code>CadastralParcel</code>.</li>
  </ol>

  <p>We start by defining the type-level functions first:</p>

  <ol class="workflow">
    <li>On the left-hand source side, select <code>CDDA_v13_sites</code>, on the right-hand target side, select <code>ProtectedSite</code>.</li>
    <li>Click on the double-arrow icon <img src="/images/tutorial-integration-02c-icon-select-function.png" class="img-rounded" /> in the middle between the source and the target schema. Hale studio now suggests a number of applicable functions. Pick &laquo;Retype&raquo; and then click &laquo;Finish&raquo;. &laquo;Retype&raquo; is a simple function that creates one target object for each source object. hale studio now runs the transformation and validates the output. Your project should look like this:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-03-first-retype.png" title="hale studio with loaded schemas, data and transformed data" style="width: 100%; min-width: 400px;">
      </div>
      Do you see all the numbers next to the elements of the source schema and the <code>ProtectedSite</code> type in the target schema? This is how the application tells you for which parts of the source and target schema features data is currently loaded and transformed.
    </li>
    <li>On the left-hand source side, select <code>CDDA_v13_sites</code>, on the right-hand target side, select <code>DesignatedArea.</code>.</li>
    <li>Click on the double-arrow icon <img src="/images/tutorial-integration-02c-icon-select-function.png" class="img-rounded" /> in the middle between the source and the target schema and pick &laquo;Retype&raquo;, then click &laquo;Finish&raquo;. Again, the transformation is executed.</li>
    <li>Now it's time to take a look at the validation results that the software generated. In the &laquo;Report List&raquo; view, click on the top-most report called &laquo;Instance validation&raquo;. In the &laquo;Properties View&raquo;, you'll see a summary of the validation. To get more details, click on &laquo;Warnings&raquo; to see the following information:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-04-validation.png" title="hale studio validation of transformed data" style="width: 100%; min-width: 400px;">
      </div>
    </li>
  </ol>

  <p>These warnings indicate that the <code>ProtectedSite</code> and <code>DesignatedArea</code> objects we've now created miss several required properties. To resolve all these warning, we need to create these required properties correctly. We do so by using property-level transformation functions:</p>

  <ol class="workflow">
    <li>On the left-hand source side, select the property <code>SITE_AREA</code> in the type <code>CDDA_v13_sites</code>, on the right-hand target side, select the property <code>area</code> in the type <code>DesignatedArea</code>.</li>
    <li>Click on the double-arrow icon <img src="/images/tutorial-integration-02c-icon-select-function.png" class="img-rounded" /> and pick &laquo;Rename&raquo;, then click &laquo;Finish&raquo;. &laquo;Rename&raquo; is an all-purpose transformation function that copies the value from the source property to the target property, and applies any required conversions, e.g. from <code>Number</code> to <code>String</code>.</li>
    <li>Take a look at the validation report details again. You will now find that while the message related to <code>area</code> is gone, there is a new message for <code>uom</code> (Unit of Measurement), an attribute of the <code>area</code> property.</li>
    <li>On the right-hand target side, select the attribute <code>uom</code> of the property <code>area</code> in the type <code>DesignatedArea</code>.</li>
    <li>Click on the double-arrow icon <img src="/images/tutorial-integration-02c-icon-select-function.png" class="img-rounded" /> and pick &laquo;Assign&raquo;. Assign is a function with which you can write a constant value to a target property. Click &laquo;Next&raquo;, then enter <code>har</code> (code for hectares) into the text input field:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-05-assign.png" title="hale studio assign a constant value" style="width: 60%; min-width: 400px; margin-left: 20%; margin-right: 20%">
      </div>
      Click &laquo;Finish&raquo;, and see the transformation and validation execute.</li>
    <li>On the left-hand source side, select the properties <code>LAT</code> and <code>LON</code> in the type <code>CDDA_v13_sites</code>, on the right-hand target side, select the sub-property <code>Point</code> of <code>representativePoint</code> in the type <code>DesignatedArea</code>.</li>
    <li>Click on <img src="/images/tutorial-integration-02c-icon-select-function.png" class="img-rounded" /> and pick &laquo;Ordinates to Point&raquo;. This function takes two numeric values and creates a <code>Point</code> geometry from them.
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-06-ordinates-to-point.png" title="hale studio transform ordinates to Point geometry" style="width: 70%; min-width: 400px; margin-left: 15%; margin-right: 15%">
      </div>
      On the first configuration page, make sure that you set the Source for <code>X</code> to <code>LON</code> and the source for <code>Y</code> to <code>LAT</code>. Also, set the source for <code>z</code> to <code>none</code>, then click &laquo;Finish&raquo;:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-06b-ordinates-to-point.png" title="hale studio transform ordinates to Point geometry" style="width: 60%; min-width: 400px; margin-left: 20%; margin-right: 20%">
      </div>
    <li>Perform the same steps of choosing the source and target schema elements and to connect them with a transformation function for the following properties. If the function is accompanies by text in round brackets (...), use these values as parameters:
      <ul>
        <li><code>SITE_CODE</code> &larr; Rename &rarr; <code>cddaId</code></li>
        <li><code>SITE_CODE</code> &larr; Formatted String (DesignatedArea_{SITE_CODE}) &rarr; <code>id</code></li>
        <li><code>CDDA_COORDINATES_CODE</code> &larr; Rename &rarr; <code>coordinatesCode.href</code></li>
        <li><code>CDDA_DISSEMINATION_CODE</code> &larr; Rename &rarr; <code>dataDissemination.href</code></li>
        <li><code>CDDA_RESOLUTION_CODE</code> &larr; Rename &rarr; <code>resolutionCode.href</code></li>
        <li><code>PARENT_ISO</code> &larr; Rename &rarr; <code>isoCountryCode.href</code></li>
        <li><code>ISO3</code> &larr; Rename &rarr; <code>isoEntityCode.href</code></li>
        <li><code>IUCNCAT</code> &larr; Rename &rarr; <code>iucnCat.href</code></li>
        <li><code>MAJOR_ECOSYSTEM_TYPE</code> &larr; Rename &rarr; <code>majorEcosystemType.href</code></li>
        <li><code>MARINE_AREA_PERC</code> &larr; Rename &rarr; <code>marineAreaPercentage</code></li>
        <li><code>SITE_NAME</code> &larr; Rename &rarr; <code>siteName.GeographicalName.spelling.SpellingOfName.text</code></li>
        <li><code>LAST_LEG_CHNG_YEAR</code> &larr; Date Extraction (yyyy) &rarr; <code>legalFoundationDate</code></li>
        <li><code>LAST_LEG_CHNG_CODE</code> &larr; Rename &rarr; <code>legalFoundationDocument.CI_Citation.title.CharacterString.CharacterString</code></li>
        <li><code>LAST_LEG_CHNG_YEAR</code> &larr; Rename &rarr; <code>legalFoundationDocument.CI_Citation.date.href</code></li>
        <li><code>NOTES</code> &larr; Rename &rarr; <code>remark</code></li>
      </ul>
      When all validation constraints are fulfilled, you've completed the mapping successfully!
    </li>
    <li>Now, create property mappings for the <code>ProtectedSite</code> type as well. The full mapping table for that is available <a href="https://taskman.eionet.europa.eu/issues/69412">here</a>.</li>
  </ol>

  <p>Now that we've created complete <code>ProtectedSite</code> and <code>DesignatedArea</code> features, we still need to link them. For that purpose, we need to add one more mapping that create a reference from a <code>DesignatedArea</code> to its respective <code>ProtectedSite</code> object:</p>

  <table class="alert-warning important-info">
    <tr>
      <td style="width:3em"><div class="important-info-icon"><span class="glyphicon glyphicon-exclamation-sign" style="font-size:2em"></span></div></td>
      <td>Note: We generate the <code>ProtectedSite</code> objects in this project as well, but in a real-world implementation, you should reference external, already existing <code>ProtectedSite</code> objects. A reference to an external object depends on a stable, permanent identifier that is resolvable (usually by means of a central registry), and is something that is out of scope for this tutorial.</td>
    </tr>
  </table>

  <ol class="workflow">
    <li>On the left-hand source side, select the property <code>SITE_CODE</code> in the type <code>CDDA_v13_sites</code>, on the right-hand target side, pick the attribute <code>href</code> of the property <code>siteDescribed</code> the type <code>DesignatedArea</code>.</li>
    <li>Click on <img src="/images/tutorial-integration-02c-icon-select-function.png" class="img-rounded" /> and pick &laquo;Formatted String&raquo;. This function takes any number of input variables and writes out a composite, formatted string. We'll configure it like this:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-07-create-reference.png" title="hale studio transform create internal reference" style="width: 60%; min-width: 400px; margin-left: 20%; margin-right: 20%">
      </div>
      The anchor (#) allows us to point to another object in the same document by its <code>id</code>.
    </li>
    <li>Now, your project should look like this:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-08-whole-project.png" title="hale studio transform whole project" style="width: 100%; min-width: 400px;">
      </div>
    </li>
  </ol>

  <p>To export the whole data as INSPIRE GML, proceed as follows:</p>

  <ol class="workflow">
    <li>In the Menu, go to Transformation &rarr; Transform External Data... and then pick the downloaded SQLIte file from the list of recent files again (or browse to identify it). Click &laquo;Next&raquo;.</li>
    <li>Pick &laquo;GML WFS 2.0 FeatureCollection&raquo; and click &laquo;Next&raquo;.</li>
    <li>Pick which file you want to save the result to, and enable validation. Click &laquo;Next&raquo;.</li>
    <li>Configure your CRS options, and click &laquo;Next&raquo;:
      <div style="margin: 20px">
        <img src="/images/tutorial-integration-09-exort.png" title="hale studio export" style="width: 60%; min-width: 400px; margin-left: 20%; margin-right: 20%">
      </div>
    </li>
    <li>Bypass the Feed options and leave the default GML options as they are. Click &laquo;Finish&raquo; and let the transformation run!</li>
  </ol>

  <h3>Performance Metrics</h3>

  <p>Now it's time to check how well the model extension we've designed matches our existing data:</p>

  <ol class="workflow">
    <li><strong>Model Coverage:</strong> Have we actually used all parts of our target model or are there parts where we don't have data? As we can see, there are some properties such as <code>eionetInstitute</code> we didn't initially populate, so we can either investiagte where to get matching source data or whether we can remove that property from the model.</li>
    <li><strong>Source Data Coverage:</strong> Have we been able to map all objects and all properties from the source model to the target model? Looks pretty good, only two fields of the source SQLite table are unmatched: <code>DESIG_ABBR</code> and <code>NUTS</code> don't seem to have a place in the CDDA INSPIRE extension. Again we need to decide: Should the next iteration of the model include properties for these values, or should we leave them out?</li>
    <li><strong>Instance complexity:</strong> How big are the individual instances? do they have a complex net of references? In this case, the instances are relatively simple in structure, with just one reference:
      <pre data-line="41" class="line-numbers" data-src="/tutorial/examples/single-designated-area.xml"><code></code></pre>
      Note that in line 42, we reference the <code>ProtectedSite</code> object we've also created.
    </li>
    <li><strong>Schema complexity:</strong> Is the schema overly complex, e.g. in terms of nesting depth? We have a few places such as <code>legalFoundationDocument</code> that have a high nesting depth. Some tools will benefit from simplification here.</li>
  </ol>

  <p>Happy with the outcome? OK, so let's see if we can publish this transformed data set to build a Download Service.</p>

  <h2><a href="#publication" id="publication" name="publication"></a>Publication</h2>

  <p>Coming soon. TODO.</p>

  <h2>Coda</h2>

  <p>Of course it's not the end yet. You will continue to improve the INSPIRE extension in short and long iterations, and we will also improve this tutorial more and more. Some ideas for the next months:</p>

  <ul>
    <li>You would like to see a different tool added? Let us know!</li>
    <li>You would like to generate services and models online without desktop or server tools? Let us know!</li>
    <li>You would like to see more patterns in the tutorial? Let us know!</li>
  </ul>

</section>
